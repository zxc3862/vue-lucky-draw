# 🔐 角色權限系統設置說明

## 📋 系統角色

### 👨‍💼 管理員 (Admin)
- **權限**: 完整管理權限
- **功能**:
  - 管理玩家 (新增、編輯、刪除)
  - 執行抽球
  - 管理用戶角色權限
  - 查看所有數據和歷史

### 👥 參加者 (Participant)  
- **權限**: 只讀權限
- **功能**:
  - 查看玩家排行榜
  - 查看抽球歷史
  - 查看統計數據

### 🌐 訪客 (Guest)
- **權限**: 公開只讀權限
- **功能**:
  - 查看基本排行榜
  - 查看抽球狀態

## 🚀 首次設置步驟

### 1. 部署 Supabase 資料庫
```sql
-- 在 Supabase SQL Editor 中執行 supabase-init.sql 的所有內容
```

### 2. 設置第一個管理員
執行 Supabase 初始化後，您需要手動設置第一個管理員：

```sql
-- 方法1: 如果您知道用戶的 UUID (登入後在認證頁面可以看到)
INSERT INTO user_roles (user_id, email, role) 
VALUES ('您的用戶UUID', '您的email@example.com', 'admin');

-- 方法2: 使用 email 查詢 (推薦)
INSERT INTO user_roles (user_id, email, role) 
SELECT 
    auth.users.id,
    '您的email@example.com',
    'admin'
FROM auth.users 
WHERE auth.users.email = '您的email@example.com';
```

### 3. 設置其他用戶
管理員登入後，可以在管理後台的「用戶權限管理」標籤中設置其他用戶的角色。

## 📱 手機響應式特色

### 🎯 自適應設計
- **導航**: 手機版會自動折疊導航欄
- **卡片**: 在小螢幕上自動調整為單列布局
- **按鈕**: 觸控友好的最小 44px 點擊區域
- **表單**: 表單元素在手機上會垂直排列

### 📐 斷點設計
- **手機**: < 640px
- **平板**: 641px - 1024px  
- **桌面**: > 1025px

### 🎨 視覺適配
- **文字大小**: 根據螢幕大小自動調整
- **間距**: 手機版減少 padding 和 margin
- **圖標**: 適當放大以便觸控操作

## 🔧 權限檢查機制

### 前端檢查
- 使用 `useAuth` Composable 進行狀態管理
- 路由守衛確保只有授權用戶能訪問管理頁面
- UI 元素根據角色動態顯示/隱藏

### 後端安全 (Supabase RLS)
- Row Level Security 確保資料安全
- 只有管理員能修改玩家和執行抽球
- 參加者只能讀取公開數據

## 🌟 使用流程

### 管理員工作流程
1. **登入**: 使用 Magic Link 登入
2. **管理玩家**: 在「玩家管理」標籤中新增/編輯玩家
3. **執行抽球**: 在「抽球管理」標籤中進行抽球
4. **設置權限**: 在「用戶權限」標籤中管理其他用戶角色

### 參加者工作流程  
1. **登入**: 使用 Magic Link 登入
2. **查看數據**: 在首頁查看排行榜和抽球歷史
3. **即時更新**: 數據會自動更新，無需重新整理

### 訪客流程
1. **瀏覽**: 直接訪問首頁查看公開資訊
2. **登入**: 點擊登入按鈕獲得更多功能

## 🔐 安全性考量

### 認證安全
- 使用 Supabase Auth 的 Magic Link，無密碼風險
- JWT Token 自動管理，安全可靠

### 權限安全  
- 前後端雙重權限檢查
- RLS 政策確保資料庫層級的安全
- 敏感操作需要管理員權限

### 資料安全
- 所有 API 請求都經過 Supabase 安全層
- 自動 HTTPS 加密
- 定期備份 (Supabase 自動)

## 🚨 故障排除

### 常見問題

**Q: 無法登入管理後台？**
A: 檢查是否已在 `user_roles` 表中設置管理員角色

**Q: 用戶看不到管理功能？**  
A: 確認用戶角色是否正確設置為 'admin'

**Q: 手機版顯示異常？**
A: 檢查瀏覽器版本，建議使用現代瀏覽器 (Chrome, Safari, Firefox)

**Q: 抽球功能無法使用？**
A: 確認總球數大於 0，且用戶具有管理員權限

### 重置步驟
如果需要重置系統：

```sql
-- 清空所有用戶角色
DELETE FROM user_roles;

-- 清空抽球歷史  
DELETE FROM draw_history;

-- 重置玩家球數
UPDATE players SET balls = 1;

-- 重新設置管理員
INSERT INTO user_roles (user_id, email, role) 
VALUES ('您的UUID', '您的email', 'admin');
```

---

🎉 設置完成後，您就擁有一個功能完整、安全可靠的抽球系統了！
